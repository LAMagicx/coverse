{% extends 'base.html' %}

{% block content %}

<div id="create-page-form"
     hx-post="/create/{{ page_id }}"
     hx-target="#main-content"
     hx-swap="innerHTML"
     x-data="{
         commands: [
             {% if page %}
                 {% for command in page.commands %}
                     { name: '{{ command.name }}', text: '{{ command.text }}', page: '{{ command.page }}', required: '{{ command.required|join(', ') }}' },
                 {% endfor %}
             {% else %}
                 { name: '', text: '', page: '', required: '' }
             {% endif %}
         ],
         limit: {{ page.limit if page else 1 }},
         maxLimit: 6,
         addCommand() {
             if (this.commands.length < this.maxLimit) {
                 this.commands.push({ name: '', text: '', page: '', required: '' });
             } else {
                 alert('Maximum number of commands reached!');
             }
         },
         removeCommand(index) {
             this.commands.splice(index, 1);
         }
     }"
>
    <div id="main-content">
        {% if error %}
        <p class="error">{{ error }}</p>
        {% endif %}
        <div id="title-content">
            <h2>Create Page {{ page_id }}</h2>
            <div id="page-title-container">
                <div class="input-container" id="page-title-input">
                    <input type="text" id="page-title" name="title" placeholder="Page Title" x-model="title" {% if page %} value="{{ page.title }}" {% endif %} required>
                    <div class="underline"></div>
                </div>
            </div>
            <div class="button-container">
                <button id="create-page-button" type="submit">Create Page</button>
            </div>
        </div>

        <div id="text-content">
            <div class="input-container">
                <input id="page-text" name="text" placeholder="Page Text" x-model="text" {% if page %}value="{{ page.text }}"{% endif %} required>
                <div class="underline"></div>
            </div>
            <div class="input-container">
                <input type="number" id="commands-limit" placeholder="Maximum commands" name="limit" min="1" max="6" x-model.number="limit" {% if page %} value="{{ page.limit }}" {% endif %} required>
                <div class="underline"></div>
            </div>
        </div>

        <div id="command-content">
            <template x-for="(command, index) in commands" :key="index">
                <div class="command" :id="'command-' + (index + 1)">
                    <h4 x-text="'Command ' + (index + 1)"></h4>
                    <div class="input-container">
                        <input type="text" :id="'command-name-' + index" :name="'commands[' + index + '][name]'" x-model="command.name" placeholder="Command Title" required>
                        <div class="underline"></div>
                    </div>
                    <div class="input-container">
                        <input type="text" :id="'command-text-' + index" :name="'commands[' + index + '][text]'" x-model="command.text" placeholder="Command Text" required>
                        <div class="underline"></div>
                    </div>
                    <div class="input-container">
                        <input type="text" :id="'command-page-' + index" :name="'commands[' + index + '][page]'" x-model="command.page" placeholder="Command Page" required>
                        <div class="underline"></div>
                    </div>
                    <div class="input-container">
                        <input type="text" :id="'required-page-ids-' + index" :name="'commands[' + index + '][required]'" x-model="command.required" placeholder="Required Pages">
                        <div class="underline"></div>
                    </div>
                    <button type="button" class="remove-button" @click="removeCommand(index)">Remove</button>
                </div>
            </template>
            <div class="command" id="add-command-button" @click="addCommand">+</div>
        </div>
    </div>
</div>

<script>
    // No more manual DOM manipulation! Alpine.js handles it.
</script>

{% endblock %}
